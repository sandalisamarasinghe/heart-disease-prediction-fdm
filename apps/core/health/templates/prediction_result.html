{% extends 'index.html' %}
{% load static %}
{% block body %}
<!-- Main Content -->
<main class="main-content">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Hero Section -->
                <div class="hero-section text-center mb-4">
                    <h1 class="hero-title">
                        <i class="fas fa-chart-line text-primary me-3"></i>
                        Heart Disease Prediction Results
                    </h1>
                    <p class="hero-subtitle">
                        Your AI-powered heart health assessment is ready
                    </p>
                </div>

                <!-- Main Results Card -->
                <div class="card-modern">
                    <div class="card-header text-center">
                        <h2 class="card-title">
                            <i class="fas fa-heartbeat me-2"></i>Prediction Results
                        </h2>
                        <p class="card-subtitle">Your heart disease risk assessment</p>
                    </div>
                    <div class="card-body">
                        <!-- Prediction Result -->
                        <div class="prediction-section mb-5">
                            <div class="prediction-result-card">
                                <div class="result-header text-center mb-4">
                                    <h3 class="result-title">
                                        <i class="fas fa-brain me-2"></i>AI Prediction Result
                                    </h3>
                                </div>
                                
                                <div class="result-content">
                                    <div class="result-display text-center mb-4">
                                        {{ prediction|safe }}
                                    </div>
                                    
                                    <div class="risk-indicator text-center mb-4">
                                        {% with pred_text=prediction|lower %}
                                            {% if "unhealthy" in pred_text or "high" in pred_text %}
                                                <div class="risk-badge high-risk">
                                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                                    <span>High Risk - Consult Doctor</span>
                                                </div>
                                            {% else %}
                                                <div class="risk-badge low-risk">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    <span>Low Risk - Keep Healthy</span>
                                                </div>
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                    
                                    <div class="accuracy-display text-center">
                                        <div class="accuracy-card">
                                            <i class="fas fa-chart-line me-2"></i>
                                            <span class="accuracy-label">Model Confidence:</span>
                                            <span class="accuracy-value">{{ accuracy|floatformat:1 }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Chart Section -->
                        <div class="chart-section mb-5">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h4 class="chart-title">
                                        <i class="fas fa-chart-pie me-2"></i>Prediction Confidence
                                    </h4>
                                    <p class="chart-subtitle">Visual representation of model confidence</p>
                                </div>
                                <div class="chart-container">
                                    <canvas id="guestProbabilityChart" height="200" aria-label="Prediction probability chart" role="img"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Health Recommendations -->
                        <div class="recommendations-section mb-5">
                            <div class="recommendations-card">
                                <div class="recommendations-header">
                                    <h4 class="recommendations-title">
                                        <i class="fas fa-lightbulb me-2"></i>Health Recommendations
                                    </h4>
                                    <p class="recommendations-subtitle">Personalized advice based on your results</p>
                                </div>
                                
                                {% if "healthy" in prediction|lower %}
                                <div class="recommendation-item success-recommendation">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="recommendation-content">
                                        <h5 class="recommendation-title">Great News! You're on the Right Track</h5>
                                        <div class="recommendation-list">
                                            <div class="recommendation-point">
                                                <i class="fas fa-heart me-2"></i>
                                                <span>Continue maintaining your healthy lifestyle</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-running me-2"></i>
                                                <span>Keep up regular exercise and balanced diet</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-calendar-check me-2"></i>
                                                <span>Schedule annual health checkups</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-chart-line me-2"></i>
                                                <span>Monitor blood pressure and cholesterol regularly</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="recommendation-item warning-recommendation">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="recommendation-content">
                                        <h5 class="recommendation-title">Important: Take Action Now</h5>
                                        <div class="recommendation-list">
                                            <div class="recommendation-point">
                                                <i class="fas fa-user-md me-2"></i>
                                                <span>Schedule a consultation with your healthcare provider</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-apple-alt me-2"></i>
                                                <span>Consider lifestyle modifications (diet, exercise)</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-eye me-2"></i>
                                                <span>Monitor symptoms and report any changes</span>
                                            </div>
                                            <div class="recommendation-point">
                                                <i class="fas fa-calendar-alt me-2"></i>
                                                <span>Schedule regular follow-up appointments</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <!-- Download Health Report Section -->
                        <div class="download-section mb-5">
                            <div class="download-card">
                                <div class="download-header">
                                    <h4 class="download-title">
                                        <i class="fas fa-download me-2"></i>Download Your Health Report
                                    </h4>
                                    <p class="download-subtitle">Get a personalized health report with detailed recommendations</p>
                                </div>
                                
                <div class="download-options">
                    <!-- Test Button -->
                    <div class="download-option" style="background: #ff6b6b; margin-bottom: 20px;">
                        <div class="download-icon">
                            <i class="fas fa-bug"></i>
                        </div>
                        <div class="download-content">
                            <h6 class="download-option-title">Test Download</h6>
                            <p class="download-option-desc">Simple test to verify download functionality</p>
                            <button class="download-btn" onclick="testDownload()" style="background: #ff6b6b;">
                                <i class="fas fa-download me-2"></i>Test Download
                            </button>
                        </div>
                    </div>
                    
                    <div class="download-option">
                        <div class="download-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="download-content">
                            <h6 class="download-option-title">PDF Health Report</h6>
                            <p class="download-option-desc">Complete health assessment with personalized recommendations</p>
                            <button class="download-btn pdf-btn" onclick="downloadHealthReport('pdf')">
                                <i class="fas fa-download me-2"></i>Download PDF
                            </button>
                        </div>
                    </div>
                                    
                                    <div class="download-option">
                                        <div class="download-icon">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="download-content">
                                            <h6 class="download-option-title">Text Summary</h6>
                                            <p class="download-option-desc">Simple text format for easy sharing with your doctor</p>
                                            <button class="download-btn text-btn" onclick="downloadHealthReport('txt')">
                                                <i class="fas fa-download me-2"></i>Download Text
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="download-option">
                                        <div class="download-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="download-content">
                                            <h6 class="download-option-title">Health Dashboard</h6>
                                            <p class="download-option-desc">Visual health metrics and progress tracking guide</p>
                                            <button class="download-btn dashboard-btn" onclick="downloadHealthReport('dashboard')">
                                                <i class="fas fa-download me-2"></i>Download Dashboard
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="download-features">
                                    <h6 class="features-title">What's Included in Your Report:</h6>
                                    <div class="features-grid">
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Detailed risk assessment</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Personalized recommendations</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Lifestyle modification tips</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Medical consultation guidance</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Follow-up schedule suggestions</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Emergency contact information</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons-section">
                            <div class="action-buttons-container">
                                <a href="{% url 'add_heartdetail' %}" class="action-btn primary-btn">
                                    <i class="fas fa-redo me-2"></i>
                                    <span>New Prediction</span>
                                </a>
                                <a href="{% url 'add_heartdetail' %}" class="action-btn success-btn">
                                    <i class="fas fa-undo me-2"></i>
                                    <span>Try Again</span>
                                </a>
                                <a href="{% url 'home' %}" class="action-btn secondary-btn">
                                    <i class="fas fa-home me-2"></i>
                                    <span>Back to Home</span>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Disclaimer -->
                        <div class="disclaimer-section">
                            <div class="disclaimer-card">
                                <div class="disclaimer-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="disclaimer-content">
                                    <h6 class="disclaimer-title">Important Medical Disclaimer</h6>
                                    <p class="disclaimer-text">
                                        This prediction is based on machine learning algorithms and should not replace professional medical advice. 
                                        Always consult with qualified healthcare professionals for medical decisions and treatment.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<style>
/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 3rem 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.hero-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    margin: 0;
}

/* Card Enhancements */
.card-modern {
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    border: none;
    overflow: hidden;
    background: white;
}

.card-header {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    color: white;
    border: none;
    padding: 2rem;
}

.card-title {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
}

.card-subtitle {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

/* Prediction Result Card */
.prediction-result-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #dee2e6;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.prediction-result-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.result-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.result-display {
    font-size: 1.8rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1.5rem;
}

/* Risk Badges */
.risk-badge {
    display: inline-flex;
    align-items: center;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.risk-badge:hover {
    transform: scale(1.05);
}

.high-risk {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
}

.low-risk {
    background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
    color: white;
}

/* Accuracy Display */
.accuracy-card {
    background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 15px;
    display: inline-flex;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.accuracy-label {
    margin-right: 0.5rem;
    font-weight: 500;
}

.accuracy-value {
    font-weight: 700;
    font-size: 1.2rem;
}

/* Chart Section */
.chart-card {
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    border: 1px solid #bbdefb;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.chart-header {
    text-align: center;
    margin-bottom: 1.5rem;
}

.chart-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.chart-subtitle {
    color: #666;
    margin: 0;
}

.chart-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
}

/* Recommendations Section */
.recommendations-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.recommendations-header {
    text-align: center;
    margin-bottom: 2rem;
}

.recommendations-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.recommendations-subtitle {
    color: #666;
    margin: 0;
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    padding: 1.5rem;
    border-radius: 15px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.recommendation-item:hover {
    transform: translateX(10px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.success-recommendation {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border-left: 5px solid #28a745;
}

.warning-recommendation {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-left: 5px solid #ffc107;
}

.recommendation-icon {
    font-size: 2rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.success-recommendation .recommendation-icon {
    color: #28a745;
}

.warning-recommendation .recommendation-icon {
    color: #ffc107;
}

.recommendation-content {
    flex: 1;
}

.recommendation-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 1rem;
}

.recommendation-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.recommendation-point {
    display: flex;
    align-items: center;
    color: #555;
    font-size: 0.95rem;
}

.recommendation-point i {
    color: #1976d2;
    width: 20px;
    flex-shrink: 0;
}

/* Action Buttons */
.action-buttons-section {
    margin: 3rem 0;
}

.action-buttons-container {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    padding: 1rem 2rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border: none;
    cursor: pointer;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    text-decoration: none;
}

.primary-btn {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    color: white;
}

.success-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.secondary-btn {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: white;
}

/* Download Section */
.download-section {
    margin: 3rem 0;
}

.download-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.download-header {
    text-align: center;
    margin-bottom: 2rem;
}

.download-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.download-subtitle {
    color: #666;
    margin: 0;
    font-size: 1.1rem;
}

.download-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.download-option {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 15px;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.download-option:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    border-color: #1976d2;
}

.download-icon {
    font-size: 2.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
    color: #1976d2;
}

.download-content {
    flex: 1;
}

.download-option-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.download-option-desc {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.4;
}

.download-btn {
    display: inline-flex;
    align-items: center;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.pdf-btn {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
}

.text-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.dashboard-btn {
    background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
    color: white;
}

.download-features {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid #e9ecef;
}

.features-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 1rem;
    text-align: center;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.8rem;
}

.feature-item {
    display: flex;
    align-items: center;
    color: #555;
    font-size: 0.9rem;
    padding: 0.5rem 0;
}

.feature-item i {
    font-size: 1rem;
}

/* Disclaimer Section */
.disclaimer-section {
    margin-top: 2rem;
}

.disclaimer-card {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 1px solid #ffc107;
    border-radius: 15px;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.disclaimer-icon {
    color: #ffc107;
    font-size: 1.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.disclaimer-content {
    flex: 1;
}

.disclaimer-title {
    color: #856404;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.disclaimer-text {
    color: #856404;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.5;
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.prediction-result-card,
.chart-card,
.recommendations-card,
.disclaimer-card {
    animation: fadeInUp 0.6s ease-out;
}

/* Responsive Design */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .action-buttons-container {
        flex-direction: column;
        align-items: center;
    }
    
    .action-btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
    }
    
    .recommendation-item {
        flex-direction: column;
        text-align: center;
    }
    
    .recommendation-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .disclaimer-card {
        flex-direction: column;
        text-align: center;
    }
    
    .disclaimer-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .download-options {
        grid-template-columns: 1fr;
    }
    
    .download-option {
        flex-direction: column;
        text-align: center;
    }
    
    .download-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    .hero-section {
        padding: 2rem 1rem;
    }
    
    .card-header {
        padding: 1.5rem;
    }
    
    .prediction-result-card,
    .chart-card,
    .recommendations-card {
        padding: 1.5rem;
    }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded',function(){
  var ctx=document.getElementById('guestProbabilityChart');
  if(ctx&&window.Chart){
    var acc=Number('{{ accuracy|default:0 }}');
    var data=[Math.max(0,Math.min(100,acc)),Math.max(0,100-Math.max(0,Math.min(100,acc)) )];
    new Chart(ctx,{type:'doughnut',data:{labels:['Predicted class confidence','Other'],datasets:[{data:data,backgroundColor:['#5A9BC3','#E8F2F7'],borderWidth:0}]},options:{plugins:{legend:{position:'bottom'}},cutout:'65%'}});
  }
});

// Test Download Function
function testDownload() {
    console.log('Test download function called');
    
    try {
        const content = 'This is a test download file. If you can see this, the download functionality is working!';
        const filename = 'test_download.txt';
        const mimeType = 'text/plain';
        
        console.log('Creating test blob...');
        const blob = new Blob([content], { type: mimeType });
        const url = window.URL.createObjectURL(blob);
        
        console.log('Creating download link...');
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.style.display = 'none';
        
        console.log('Adding to DOM and clicking...');
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        console.log('Test download completed');
        alert('Test download completed! Check your downloads folder.');
        
    } catch (error) {
        console.error('Error in test download:', error);
        alert('Test download failed: ' + error.message);
    }
}

// Alternative Download Function (simpler method)
function alternativeDownload(content, filename, mimeType) {
    console.log('Using alternative download method');
    
    try {
        // Method 1: Direct blob download
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        URL.revokeObjectURL(url);
        
        return true;
    } catch (error) {
        console.error('Alternative download failed:', error);
        
        // Method 2: Open in new window
        try {
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(content);
                newWindow.document.close();
                newWindow.document.title = filename;
                return true;
            }
        } catch (windowError) {
            console.error('Window method failed:', windowError);
        }
        
        return false;
    }
}

// Download Health Report Function
function downloadHealthReport(format) {
    console.log('Download function called with format:', format);
    
    try {
        const prediction = '{{ prediction|safe }}';
        const accuracy = '{{ accuracy|default:0 }}';
        const isHealthy = prediction.includes('healthy') || prediction.includes('Healthy');
        const currentDate = new Date().toLocaleDateString();
        const currentTime = new Date().toLocaleTimeString();
        
        console.log('Prediction:', prediction);
        console.log('Accuracy:', accuracy);
        console.log('Is Healthy:', isHealthy);
        console.log('Date:', currentDate);
        console.log('Time:', currentTime);
        
        let content = '';
        let filename = '';
        let mimeType = '';
        
        if (format === 'pdf') {
            console.log('Generating PDF content...');
            content = generateAttractivePDFContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Heart_Health_Report_${currentDate.replace(/\//g, '-')}.html`;
            mimeType = 'text/html';
        } else if (format === 'txt') {
            console.log('Generating Text content...');
            content = generateAttractiveTextContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Heart_Health_Summary_${currentDate.replace(/\//g, '-')}.txt`;
            mimeType = 'text/plain';
        } else if (format === 'dashboard') {
            console.log('Generating Dashboard content...');
            content = generateAttractiveDashboardContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Health_Dashboard_${currentDate.replace(/\//g, '-')}.html`;
            mimeType = 'text/html';
        }
        
        console.log('Content length:', content.length);
        console.log('Filename:', filename);
        console.log('MIME type:', mimeType);
        
        // Try alternative download method first
        console.log('Attempting alternative download method...');
        const success = alternativeDownload(content, filename, mimeType);
        
        if (success) {
            console.log('Alternative download method succeeded');
        } else {
            console.log('Alternative download failed, trying original method...');
            
            // Original method as fallback
            console.log('Creating blob...');
            const blob = new Blob([content], { type: mimeType });
            console.log('Blob created, size:', blob.size);
            
            console.log('Creating object URL...');
            const url = window.URL.createObjectURL(blob);
            console.log('Object URL created:', url);
            
            console.log('Creating download link...');
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            a.target = '_blank';
            
            console.log('Adding link to DOM...');
            document.body.appendChild(a);
            
            console.log('Triggering download...');
            a.click();
            
            console.log('Cleaning up...');
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                console.log('Cleanup completed');
            }, 100);
        }
        
        console.log('Download process completed');
        
        // Show success message
        showDownloadSuccess(format);
        
    } catch (error) {
        console.error('Error in download function:', error);
        alert('Error generating download: ' + error.message);
    }
}

function generateAttractivePDFContent(prediction, accuracy, isHealthy, date, time) {
    return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Health Report - ${date}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%); 
            color: white; 
            padding: 40px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content { padding: 40px; }
        .section { margin-bottom: 30px; }
        .section h2 { 
            color: #1976d2; 
            font-size: 1.8em; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 3px solid #1976d2; 
        }
        .prediction-result { 
            background: ${isHealthy ? 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)' : 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)'}; 
            padding: 20px; 
            border-radius: 15px; 
            border-left: 5px solid ${isHealthy ? '#28a745' : '#dc3545'}; 
            margin: 20px 0; 
        }
        .prediction-result h3 { 
            color: ${isHealthy ? '#155724' : '#721c24'}; 
            font-size: 1.5em; 
            margin-bottom: 10px; 
        }
        .confidence { 
            background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            text-align: center; 
            font-size: 1.2em; 
            font-weight: 600; 
            margin: 20px 0; 
        }
        .recommendations { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid #dee2e6; 
        }
        .recommendations ul { list-style: none; padding: 0; }
        .recommendations li { 
            padding: 8px 0; 
            border-bottom: 1px solid #e9ecef; 
            display: flex; 
            align-items: center; 
        }
        .recommendations li:last-child { border-bottom: none; }
        .recommendations li::before { 
            content: '${isHealthy ? '‚úì' : '‚ö†Ô∏è'}'; 
            color: ${isHealthy ? '#28a745' : '#ffc107'}; 
            font-weight: bold; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .emergency { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
            border: 2px solid #ffc107; 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
        }
        .emergency h3 { color: #856404; margin-bottom: 15px; }
        .footer { 
            background: #2c3e50; 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .footer p { margin: 5px 0; opacity: 0.9; }
        .highlight { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            padding: 15px; 
            border-radius: 10px; 
            margin: 15px 0; 
            border-left: 4px solid #1976d2; 
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            border: 1px solid #e9ecef; 
        }
        .card h4 { color: #1976d2; margin-bottom: 10px; }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Heart Health Report</h1>
            <p>Generated on ${date} at ${time}</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>üìä Prediction Results</h2>
                <div class="prediction-result">
                    <h3>${prediction.replace(/<[^>]*>/g, '')}</h3>
                </div>
                <div class="confidence">
                    Model Confidence: ${accuracy}%
                </div>
            </div>

            <div class="section">
                <h2>${isHealthy ? 'üíö Healthy Lifestyle Recommendations' : 'üö® Urgent Health Actions Required'}</h2>
                <div class="recommendations">
                    <ul>
                        ${isHealthy ? getHealthyRecommendationsHTML() : getUnhealthyRecommendationsHTML()}
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>üìã Detailed Health Guidance</h2>
                <div class="highlight">
                    ${isHealthy ? getHealthyDetailedGuidanceHTML() : getUnhealthyDetailedGuidanceHTML()}
                </div>
            </div>

            <div class="section">
                <h2>üìû Emergency Contacts</h2>
                <div class="emergency">
                    <h3>üö® Emergency Services</h3>
                    <p><strong>US:</strong> 911 | <strong>UK:</strong> 999 | <strong>EU:</strong> 112</p>
                    <p><strong>National Heart Helpline:</strong> 1-800-HEART-1</p>
                    <p><strong>Your Local Hospital:</strong> Contact your nearest hospital</p>
                </div>
            </div>

            <div class="section">
                <h2>üìÖ Follow-up Schedule</h2>
                <div class="grid">
                    <div class="card">
                        <h4>Immediate Actions</h4>
                        <p>${isHealthy ? 'Continue current healthy lifestyle' : 'Schedule cardiologist appointment within 1 week'}</p>
                    </div>
                    <div class="card">
                        <h4>Short-term (1-3 months)</h4>
                        <p>${isHealthy ? 'Annual physical examination' : 'Follow-up every 3-6 months'}</p>
                    </div>
                    <div class="card">
                        <h4>Long-term (6-12 months)</h4>
                        <p>${isHealthy ? 'Continue monitoring and healthy habits' : 'Regular medication review and lifestyle adjustments'}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Important Disclaimer:</strong></p>
            <p>This report is generated by an AI system and should not replace professional medical advice.</p>
            <p>Always consult with qualified healthcare professionals for medical decisions and treatment.</p>
            <p>Generated by Heart Disease Prediction System | ${date}</p>
        </div>
    </div>
</body>
</html>
    `.trim();
}

function generateAttractiveTextContent(prediction, accuracy, isHealthy, date, time) {
    return `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                           üè• HEART HEALTH SUMMARY üè•                        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìÖ Date: ${date}
üïê Time: ${time}
üìä Confidence: ${accuracy}%

${'='.repeat(80)}

üéØ PREDICTION RESULT:
${prediction.replace(/<[^>]*>/g, '')}

${'='.repeat(80)}

${isHealthy ? 'üíö KEEP UP THE GOOD WORK! üíö' : 'üö® ACTION REQUIRED - CONSULT YOUR DOCTOR üö®'}

${'='.repeat(80)}

üìã RECOMMENDATIONS:
${isHealthy ? getHealthyRecommendations() : getUnhealthyRecommendations()}

${'='.repeat(80)}

üìÖ NEXT STEPS:
${isHealthy ? getHealthyFollowUp() : getUnhealthyFollowUp()}

${'='.repeat(80)}

üö® EMERGENCY CONTACTS:
‚Ä¢ Emergency Services: 911 (US) / 999 (UK) / 112 (EU)
‚Ä¢ National Heart Helpline: 1-800-HEART-1
‚Ä¢ Your Local Hospital: Contact your nearest hospital

${'='.repeat(80)}

‚ö†Ô∏è  IMPORTANT DISCLAIMER:
This report is generated by an AI system and should not replace 
professional medical advice. Always consult with qualified healthcare 
professionals for medical decisions and treatment.

Generated by Heart Disease Prediction System
For more information, visit: http://127.0.0.1:8000

${'='.repeat(80)}
    `.trim();
}

function generateAttractiveDashboardContent(prediction, accuracy, isHealthy, date, time) {
    return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard - ${date}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }
        .status-card { 
            background: ${isHealthy ? 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)' : 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)'}; 
            padding: 25px; 
            border-radius: 15px; 
            border-left: 5px solid ${isHealthy ? '#28a745' : '#dc3545'}; 
            margin: 20px 0; 
            text-align: center;
        }
        .status-card h2 { 
            color: ${isHealthy ? '#155724' : '#721c24'}; 
            font-size: 1.8em; 
            margin-bottom: 10px; 
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 30px 0; 
        }
        .metric-card { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            border: 1px solid #e9ecef; 
        }
        .metric-card h3 { 
            color: #6f42c1; 
            margin-bottom: 15px; 
            font-size: 1.3em; 
            display: flex; 
            align-items: center; 
        }
        .metric-card h3::before { 
            content: 'üìä'; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .checklist { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid #dee2e6; 
            margin: 20px 0; 
        }
        .checklist h3 { 
            color: #6f42c1; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
        }
        .checklist h3::before { 
            content: '‚úÖ'; 
            margin-right: 10px; 
        }
        .checklist-item { 
            padding: 8px 0; 
            border-bottom: 1px solid #e9ecef; 
            display: flex; 
            align-items: center; 
        }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-item::before { 
            content: '‚òê'; 
            color: #6f42c1; 
            font-weight: bold; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .progress-bar { 
            background: #e9ecef; 
            border-radius: 10px; 
            height: 20px; 
            margin: 10px 0; 
            overflow: hidden; 
        }
        .progress-fill { 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
            height: 100%; 
            border-radius: 10px; 
            transition: width 0.3s ease; 
        }
        .footer { 
            background: #2c3e50; 
            color: white; 
            padding: 25px; 
            text-align: center; 
        }
        .highlight { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
            border-left: 5px solid #6f42c1; 
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Health Dashboard</h1>
            <p>Generated on ${date} at ${time} | Confidence: ${accuracy}%</p>
        </div>
        
        <div class="content">
            <div class="status-card">
                <h2>${prediction.replace(/<[^>]*>/g, '')}</h2>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Health Metrics</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyMetricsHTML() : getUnhealthyMetricsHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Goal Setting</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyGoalsHTML() : getUnhealthyGoalsHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Progress Tracking</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyProgressHTML() : getUnhealthyProgressHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Health Checklist</h3>
                    <div class="checklist">
                        ${isHealthy ? getHealthyChecklistHTML() : getUnhealthyChecklistHTML()}
                    </div>
                </div>
            </div>

            <div class="highlight">
                <h3 style="color: #6f42c1; margin-bottom: 15px;">üìä Health Progress Visualization</h3>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${isHealthy ? '85' : '35'}%;"></div>
                </div>
                <p style="text-align: center; margin-top: 10px; font-weight: 600;">
                    ${isHealthy ? 'Excellent Health Status - Keep it up!' : 'Room for Improvement - Stay motivated!'}
                </p>
            </div>
        </div>

        <div class="footer">
            <p><strong>Health Dashboard Generated by Heart Disease Prediction System</strong></p>
            <p>Use this dashboard to track your heart health journey and maintain your wellness goals.</p>
            <p>Generated on ${date} | For more information, visit: http://127.0.0.1:8000</p>
        </div>
    </div>
</body>
</html>
    `.trim();
}

function getHealthyRecommendations() {
    return `
‚úì Continue maintaining your healthy lifestyle
‚úì Regular exercise (30 minutes daily)
‚úì Balanced diet with fruits and vegetables
‚úì Annual health checkups
‚úì Monitor blood pressure and cholesterol
‚úì Get adequate sleep (7-8 hours)
‚úì Manage stress effectively
‚úì Avoid smoking and excessive alcohol
    `.trim();
}

function getUnhealthyRecommendations() {
    return `
‚ö†Ô∏è Schedule immediate consultation with cardiologist
‚ö†Ô∏è Start heart-healthy diet immediately
‚ö†Ô∏è Begin supervised exercise program
‚ö†Ô∏è Monitor blood pressure daily
‚ö†Ô∏è Take prescribed medications as directed
‚ö†Ô∏è Quit smoking if applicable
‚ö†Ô∏è Reduce alcohol consumption
‚ö†Ô∏è Emergency plan for chest pain symptoms
    `.trim();
}

function getHealthyDetailedGuidance() {
    return `
NUTRITION GUIDANCE:
- Eat 5-7 servings of fruits and vegetables daily
- Choose whole grains over refined grains
- Include lean proteins (fish, poultry, beans)
- Limit saturated fats and trans fats
- Reduce sodium intake to <2,300mg daily

EXERCISE RECOMMENDATIONS:
- 150 minutes moderate aerobic activity weekly
- 75 minutes vigorous activity weekly
- Strength training 2-3 times per week
- Include flexibility and balance exercises

STRESS MANAGEMENT:
- Practice meditation or deep breathing
- Maintain work-life balance
- Get adequate sleep
- Engage in hobbies and social activities
    `.trim();
}

function getUnhealthyDetailedGuidance() {
    return `
IMMEDIATE ACTIONS REQUIRED:
- Contact your doctor within 24-48 hours
- If experiencing chest pain, call emergency services
- Start heart-healthy diet immediately
- Begin light exercise only with doctor approval

DIETARY CHANGES:
- Reduce sodium to <1,500mg daily
- Increase fiber intake (25-35g daily)
- Limit saturated fat to <7% of calories
- Avoid processed foods and sugary drinks
- Increase omega-3 fatty acids

MEDICATION COMPLIANCE:
- Take all prescribed medications as directed
- Never stop medications without doctor approval
- Keep a medication schedule
- Report any side effects immediately

SYMPTOM MONITORING:
- Track chest pain, shortness of breath, fatigue
- Monitor blood pressure and heart rate
- Keep a symptom diary
- Know when to seek emergency care
    `.trim();
}

function getHealthyFollowUp() {
    return `
- Annual physical examination
- Blood pressure check every 6 months
- Cholesterol test annually
- Continue current healthy lifestyle
- Regular dental checkups (gum health affects heart)
- Eye exams (diabetes screening)
    `.trim();
}

function getUnhealthyFollowUp() {
    return `
- Cardiologist appointment within 1 week
- Follow-up every 3-6 months
- Blood pressure monitoring weekly
- Cholesterol test in 3 months
- Stress test as recommended
- Medication review monthly
- Emergency plan in place
    `.trim();
}

function getHealthyMetrics() {
    return `
Target Blood Pressure: <120/80 mmHg
Target Cholesterol: <200 mg/dL
Target BMI: 18.5-24.9
Target Waist Circumference: <35" (women), <40" (men)
Target Exercise: 150 min/week moderate activity
Target Sleep: 7-8 hours nightly
    `.trim();
}

function getUnhealthyMetrics() {
    return `
Current Priority: Blood Pressure <140/90 mmHg
Target Cholesterol: <200 mg/dL (or as prescribed)
Weight Management: Gradual 5-10% weight loss
Exercise: Start with 10-15 min daily, increase gradually
Blood Sugar: Monitor if diabetic
Medication Adherence: 100% compliance
    `.trim();
}

function getHealthyGoals() {
    return `
- Maintain current healthy lifestyle
- Continue regular exercise routine
- Keep up balanced nutrition
- Annual health screenings
- Stress management techniques
- Regular sleep schedule
    `.trim();
}

function getUnhealthyGoals() {
    return `
- Lower blood pressure to target range
- Reduce cholesterol levels
- Achieve healthy weight
- Increase physical activity gradually
- Improve diet quality
- Quit smoking (if applicable)
- Manage stress effectively
    `.trim();
}

function getHealthyProgress() {
    return `
Monthly Tracking:
‚ñ° Blood pressure check
‚ñ° Weight monitoring
‚ñ° Exercise log review
‚ñ° Sleep quality assessment
‚ñ° Stress level evaluation
‚ñ° Nutrition review
    `.trim();
}

function getUnhealthyProgress() {
    return `
Weekly Tracking:
‚ñ° Blood pressure readings
‚ñ° Weight measurement
‚ñ° Medication compliance
‚ñ° Exercise minutes
‚ñ° Symptom monitoring
‚ñ° Doctor appointment scheduling
    `.trim();
}

function getHealthyChecklist() {
    return `
‚ñ° 30 minutes of exercise
‚ñ° 5+ servings fruits/vegetables
‚ñ° Adequate water intake
‚ñ° 7-8 hours sleep
‚ñ° Stress management practice
‚ñ° Regular meal times
‚ñ° Social connection
‚ñ° Hobby time
    `.trim();
}

function getUnhealthyChecklist() {
    return `
‚ñ° Take all prescribed medications
‚ñ° Monitor blood pressure
‚ñ° Follow heart-healthy diet
‚ñ° Light exercise (as approved)
‚ñ° Track symptoms
‚ñ° Avoid smoking/alcohol
‚ñ° Manage stress
‚ñ° Contact doctor if needed
    `.trim();
}

function showDownloadSuccess(format) {
    const formatNames = {
        'pdf': 'PDF Health Report',
        'txt': 'Text Summary',
        'dashboard': 'Health Dashboard'
    };
    
    // Create success notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        font-weight: 600;
        animation: slideInRight 0.3s ease-out;
    `;
    
    notification.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        ${formatNames[format]} downloaded successfully!
    `;
    
    document.body.appendChild(notification);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// HTML Helper Functions
function getHealthyRecommendationsHTML() {
    return `
        <li>Continue maintaining your healthy lifestyle</li>
        <li>Regular exercise (30 minutes daily)</li>
        <li>Balanced diet with fruits and vegetables</li>
        <li>Annual health checkups</li>
        <li>Monitor blood pressure and cholesterol</li>
        <li>Get adequate sleep (7-8 hours)</li>
        <li>Manage stress effectively</li>
        <li>Avoid smoking and excessive alcohol</li>
    `.trim();
}

function getUnhealthyRecommendationsHTML() {
    return `
        <li>Schedule immediate consultation with cardiologist</li>
        <li>Start heart-healthy diet immediately</li>
        <li>Begin supervised exercise program</li>
        <li>Monitor blood pressure daily</li>
        <li>Take prescribed medications as directed</li>
        <li>Quit smoking if applicable</li>
        <li>Reduce alcohol consumption</li>
        <li>Emergency plan for chest pain symptoms</li>
    `.trim();
}

function getHealthyDetailedGuidanceHTML() {
    return `
        <h4>ü•ó NUTRITION GUIDANCE:</h4>
        <p>‚Ä¢ Eat 5-7 servings of fruits and vegetables daily</p>
        <p>‚Ä¢ Choose whole grains over refined grains</p>
        <p>‚Ä¢ Include lean proteins (fish, poultry, beans)</p>
        <p>‚Ä¢ Limit saturated fats and trans fats</p>
        <p>‚Ä¢ Reduce sodium intake to <2,300mg daily</p>
        
        <h4>üèÉ EXERCISE RECOMMENDATIONS:</h4>
        <p>‚Ä¢ 150 minutes moderate aerobic activity weekly</p>
        <p>‚Ä¢ 75 minutes vigorous activity weekly</p>
        <p>‚Ä¢ Strength training 2-3 times per week</p>
        <p>‚Ä¢ Include flexibility and balance exercises</p>
        
        <h4>üßò STRESS MANAGEMENT:</h4>
        <p>‚Ä¢ Practice meditation or deep breathing</p>
        <p>‚Ä¢ Maintain work-life balance</p>
        <p>‚Ä¢ Get adequate sleep</p>
        <p>‚Ä¢ Engage in hobbies and social activities</p>
    `.trim();
}

function getUnhealthyDetailedGuidanceHTML() {
    return `
        <h4>üö® IMMEDIATE ACTIONS REQUIRED:</h4>
        <p>‚Ä¢ Contact your doctor within 24-48 hours</p>
        <p>‚Ä¢ If experiencing chest pain, call emergency services</p>
        <p>‚Ä¢ Start heart-healthy diet immediately</p>
        <p>‚Ä¢ Begin light exercise only with doctor approval</p>
        
        <h4>ü•ó DIETARY CHANGES:</h4>
        <p>‚Ä¢ Reduce sodium to <1,500mg daily</p>
        <p>‚Ä¢ Increase fiber intake (25-35g daily)</p>
        <p>‚Ä¢ Limit saturated fat to <7% of calories</p>
        <p>‚Ä¢ Avoid processed foods and sugary drinks</p>
        <p>‚Ä¢ Increase omega-3 fatty acids</p>
        
        <h4>üíä MEDICATION COMPLIANCE:</h4>
        <p>‚Ä¢ Take all prescribed medications as directed</p>
        <p>‚Ä¢ Never stop medications without doctor approval</p>
        <p>‚Ä¢ Keep a medication schedule</p>
        <p>‚Ä¢ Report any side effects immediately</p>
    `.trim();
}

function getHealthyMetricsHTML() {
    return `
        <p><strong>Target Blood Pressure:</strong> <120/80 mmHg</p>
        <p><strong>Target Cholesterol:</strong> <200 mg/dL</p>
        <p><strong>Target BMI:</strong> 18.5-24.9</p>
        <p><strong>Target Waist Circumference:</strong> <35" (women), <40" (men)</p>
        <p><strong>Target Exercise:</strong> 150 min/week moderate activity</p>
        <p><strong>Target Sleep:</strong> 7-8 hours nightly</p>
    `.trim();
}

function getUnhealthyMetricsHTML() {
    return `
        <p><strong>Current Priority:</strong> Blood Pressure <140/90 mmHg</p>
        <p><strong>Target Cholesterol:</strong> <200 mg/dL (or as prescribed)</p>
        <p><strong>Weight Management:</strong> Gradual 5-10% weight loss</p>
        <p><strong>Exercise:</strong> Start with 10-15 min daily, increase gradually</p>
        <p><strong>Blood Sugar:</strong> Monitor if diabetic</p>
        <p><strong>Medication Adherence:</strong> 100% compliance</p>
    `.trim();
}

function getHealthyGoalsHTML() {
    return `
        <p>‚Ä¢ Maintain current healthy lifestyle</p>
        <p>‚Ä¢ Continue regular exercise routine</p>
        <p>‚Ä¢ Keep up balanced nutrition</p>
        <p>‚Ä¢ Annual health screenings</p>
        <p>‚Ä¢ Stress management techniques</p>
        <p>‚Ä¢ Regular sleep schedule</p>
    `.trim();
}

function getUnhealthyGoalsHTML() {
    return `
        <p>‚Ä¢ Lower blood pressure to target range</p>
        <p>‚Ä¢ Reduce cholesterol levels</p>
        <p>‚Ä¢ Achieve healthy weight</p>
        <p>‚Ä¢ Increase physical activity gradually</p>
        <p>‚Ä¢ Improve diet quality</p>
        <p>‚Ä¢ Quit smoking (if applicable)</p>
        <p>‚Ä¢ Manage stress effectively</p>
    `.trim();
}

function getHealthyProgressHTML() {
    return `
        <h4>üìÖ Monthly Tracking:</h4>
        <p>‚Ä¢ Blood pressure check</p>
        <p>‚Ä¢ Weight monitoring</p>
        <p>‚Ä¢ Exercise log review</p>
        <p>‚Ä¢ Sleep quality assessment</p>
        <p>‚Ä¢ Stress level evaluation</p>
        <p>‚Ä¢ Nutrition review</p>
    `.trim();
}

function getUnhealthyProgressHTML() {
    return `
        <h4>üìÖ Weekly Tracking:</h4>
        <p>‚Ä¢ Blood pressure readings</p>
        <p>‚Ä¢ Weight measurement</p>
        <p>‚Ä¢ Medication compliance</p>
        <p>‚Ä¢ Exercise minutes</p>
        <p>‚Ä¢ Symptom monitoring</p>
        <p>‚Ä¢ Doctor appointment scheduling</p>
    `.trim();
}

function getHealthyChecklistHTML() {
    return `
        <div class="checklist-item">30 minutes of exercise</div>
        <div class="checklist-item">5+ servings fruits/vegetables</div>
        <div class="checklist-item">Adequate water intake</div>
        <div class="checklist-item">7-8 hours sleep</div>
        <div class="checklist-item">Stress management practice</div>
        <div class="checklist-item">Regular meal times</div>
        <div class="checklist-item">Social connection</div>
        <div class="checklist-item">Hobby time</div>
    `.trim();
}

function getUnhealthyChecklistHTML() {
    return `
        <div class="checklist-item">Take all prescribed medications</div>
        <div class="checklist-item">Monitor blood pressure</div>
        <div class="checklist-item">Follow heart-healthy diet</div>
        <div class="checklist-item">Light exercise (as approved)</div>
        <div class="checklist-item">Track symptoms</div>
        <div class="checklist-item">Avoid smoking/alcohol</div>
        <div class="checklist-item">Manage stress</div>
        <div class="checklist-item">Contact doctor if needed</div>
    `.trim();
}
</script>
{% endblock %}
