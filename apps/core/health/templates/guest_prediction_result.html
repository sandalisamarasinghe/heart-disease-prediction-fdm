{% extends 'index.html' %}
{% load static %}
{% block body %}
<!-- Header removed; using base navbar -->
<!-- Main Content -->
<main class="main-content">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card-modern">
                    <div class="card-header text-center">
                        <h2 class="card-title text-primary">
                            <i class="fas fa-chart-line me-2"></i>Prediction Results
                        </h2>
                        <p class="card-subtitle text-muted">Your heart disease risk assessment</p>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Guest Mode:</strong> This is a one-time prediction. 
                            <a href="{% url 'signup' %}" class="alert-link">Create a free account</a> to save results and track your health over time.
                        </div>
                        <!-- Prediction Result -->
                        <div class="text-center mb-4">
                            <div class="prediction-result p-4 rounded">
                                <h3 class="mb-3">AI Prediction Result</h3>
                                <div class="result-display mb-3">
                                    {{ prediction|safe }}
                                </div>
                                <div class="mb-3">
                                    {% with pred_text=prediction|lower %}
                                        {% if "high" in pred_text %}
                                            <span class="badge bg-danger" style="font-size:1rem; padding:.6rem 1rem; border-radius:9999px;">High Risk</span>
                                        {% elif "medium" in pred_text %}
                                            <span class="badge bg-warning" style="font-size:1rem; padding:.6rem 1rem; border-radius:9999px;">Medium Risk</span>
                                        {% else %}
                                            <span class="badge bg-success" style="font-size:1rem; padding:.6rem 1rem; border-radius:9999px;">Low Risk</span>
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                <div class="accuracy-info">
                                    <span class="badge bg-info fs-6">Model Accuracy: {{ accuracy|floatformat:2 }}%</span>
                                </div>
                            </div>
                        </div>
                        <!-- Chart Placeholder -->
                        <div class="mb-4">
                            <div class="card-modern" style="padding:1rem;">
                                <h6 class="mb-3 text-secondary"><i class="fas fa-chart-pie me-2"></i>Probability Distribution</h6>
                                <canvas id="guestProbabilityChart" height="140" aria-label="Prediction probability chart" role="img"></canvas>
                            </div>
                        </div>
                        <!-- Health Recommendations -->
                        <div class="health-recommendations mt-4">
                            <h4 class="text-primary mb-3">
                                <i class="fas fa-lightbulb me-2"></i>Health Recommendations
                            </h4>
                            {% if "healthy" in prediction|lower %}
                            <div class="alert alert-success">
                                <h5><i class="fas fa-check-circle me-2"></i>Great News!</h5>
                                <ul class="mb-0">
                                    <li>Continue maintaining your healthy lifestyle</li>
                                    <li>Regular exercise and balanced diet</li>
                                    <li>Annual health checkups</li>
                                    <li>Monitor blood pressure and cholesterol regularly</li>
                                </ul>
                            </div>
                            {% else %}
                            <div class="alert alert-warning">
                                <h5><i class="fas fa-exclamation-triangle me-2"></i>Precautionary Measures</h5>
                                <ul class="mb-0">
                                    <li>Schedule a consultation with your healthcare provider</li>
                                    <li>Consider lifestyle modifications (diet, exercise)</li>
                                    <li>Monitor symptoms and report any changes</li>
                                    <li>Regular follow-up appointments</li>
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                        <!-- Action Buttons -->
                        <div class="text-center mt-5">
                            <a href="{% url 'guest_prediction' %}" class="btn-modern btn-primary me-3">
                                <i class="fas fa-redo me-2"></i>New Prediction
                            </a>
                            <a href="{% url 'guest_prediction' %}" class="btn-modern btn-success me-3">
                                <i class="fas fa-undo me-2"></i>Try Again
                            </a>
                            <a href="{% url 'signup' %}" class="btn-modern btn-success me-3">
                                <i class="fas fa-user-plus me-2"></i>Create Account
                            </a>
                            <a href="{% url 'home' %}" class="btn-modern btn-secondary">
                                <i class="fas fa-home me-2"></i>Back to Home
                            </a>
                        </div>
                        <!-- Disclaimer -->
                        <div class="mt-4 p-3 bg-light rounded">
                            <small class="text-muted">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                <strong>Disclaimer:</strong> This prediction is based on machine learning algorithms and should not replace professional medical advice. 
                                Always consult with qualified healthcare professionals for medical decisions.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<style>
.prediction-result{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);border:2px solid #dee2e6}
.result-display{font-size:1.5rem;font-weight:600}
.accuracy-info .badge{font-size:1rem;padding:.5rem 1rem}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded',function(){
  var ctx=document.getElementById('guestProbabilityChart');
  if(ctx&&window.Chart){
    var acc=Number('{{ accuracy|default:0 }}');
    var data=[Math.max(0,Math.min(100,acc)),Math.max(0,100-Math.max(0,Math.min(100,acc)) )];
    new Chart(ctx,{type:'doughnut',data:{labels:['Predicted class confidence','Other'],datasets:[{data:data,backgroundColor:['#5A9BC3','#E8F2F7'],borderWidth:0}]},options:{plugins:{legend:{position:'bottom'}},cutout:'65%'}});
  }
});
</script>
{% endblock %}
